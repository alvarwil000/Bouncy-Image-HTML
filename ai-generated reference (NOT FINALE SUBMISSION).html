<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>v1.5.1 Bouncy DVD logo with gravity (with sound)</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    width: 100%;
    background: transparent;
    overflow: hidden;
    cursor: grab;
  }

  #dvd {
    position: absolute;
    width: 100px;
    height: 100px;
    transform-origin: center;
    cursor: grab;
    z-index: 1;
    background-image: url('https://raw.githubusercontent.com/alvarwil000/Dodgeball-HTML/refs/heads/main/Dodgeball-resources/Dodgeball.png');
    background-size: 100% 100%;
    background-position: center;
    background-repeat: no-repeat;
  }

  /*
      TEXT/CODE GENERATIVE AI HAS BEEN USED IN THIS FILE, THIS IS NOT MY FINALE SUBMISSION, THIS IS JUST A REFERENCE SINCE I AM STILL LEARNING A FEW THINGS SINCE I'VE MISSED THE FIRST COUPLE OF LESSONS
DO NOT GRADE ME BASED ON THIS FILE
*/
  
  /* small control button so user can unlock audio (browsers require a user gesture) */
  #enableSound {
    position: fixed;
    left: 12px;
    top: 12px;
    z-index: 5;
    padding: 6px 10px;
    font-size: 13px;
    border-radius: 6px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(255,255,255,0.9);
    cursor: pointer;
  }
</style>
</head>
<body>
  <button id="enableSound">Enable sound</button>
  <div id="dvd"></div>

<script>
/*
  Added: bounce sound that plays when the DVD/image bounces off edges.
  - SOUND_URL points to a GitHub raw MP3 file (change if your file is elsewhere).
  - Browsers block autoplay: click "Enable sound" once to unlock audio.
  - The sound plays only for meaningful bounces (based on pre-bounce speed).
*/

const dvd = document.getElementById('dvd');

// starting position (random)
let x = Math.random() * (window.innerWidth - 1);
let y = Math.random() * (window.innerHeight - 1);

// starting velocity (random)
let dx = (Math.random() * 4 + 2) * (Math.random() < 0.5 ? 1 : -1);
let dy = (Math.random() * 4 + 2) * (Math.random() < 0.5 ? 1 : -1);

const gravity = 0.2, friction = 0.995, VELOCITY_EPS = 0.5;
let currentAngle = 0;

// dragging
let isDragging = false, offsetX = 0, offsetY = 0;

dvd.addEventListener('mousedown', e => {
  isDragging = true;
  offsetX = e.clientX - x;
  offsetY = e.clientY - y;
  dvd.style.cursor = 'grabbing';
});

document.addEventListener('mouseup', e => {
  isDragging = false;
  dvd.style.cursor = 'grab';
  dx = (e.clientX - x - offsetX) * 0.2;
  dy = (e.clientY - y - offsetY) * 0.2;
});

document.addEventListener('mousemove', e => {
  if (isDragging) { x = e.clientX - offsetX; y = e.clientY - offsetY; }
});

// random pushes every 3â€“15 sec
function randomPush() {
  if (!isDragging) {
    const angle = Math.random() * Math.PI * 2;
    const force = Math.random() * 10 + 5;
    dx += Math.cos(angle) * force;
    dy += Math.sin(angle) * force * 1.5; // pushes up more
  }
  setTimeout(randomPush, 3000 + Math.random() * 12000);
}
setTimeout(randomPush, 3000 + Math.random() * 12000);

/* -------- SOUND SETUP -------- */

// Replace this with your MP3 raw URL if different.
// Example used earlier: https://raw.githubusercontent.com/alvarwil000/Bouncy-Image-HTML/main/Dodgeball-resources/Bounce.mp3
const SOUND_URL = 'https://raw.githubusercontent.com/alvarwil000/Bouncy-Image-HTML/main/Dodgeball-resources/Bounce.mp3';

const bounceSound = new Audio(SOUND_URL);
bounceSound.preload = 'auto';

// button to unlock audio (user gesture required by many browsers)
const enableBtn = document.getElementById('enableSound');
let soundUnlocked = false;

enableBtn.addEventListener('click', async () => {
  try {
    // try to play/pause to "unlock" audio
    await bounceSound.play();
    bounceSound.pause();
    bounceSound.currentTime = 0;
    soundUnlocked = true;
    enableBtn.disabled = true;
    enableBtn.textContent = 'Sound enabled';
  } catch (err) {
    console.warn('Audio unlock attempt failed:', err);
    enableBtn.textContent = 'Click anywhere to enable sound';
    // as fallback: add a one-time global click to try unlocking
    const oneTime = async () => {
      try {
        await bounceSound.play();
        bounceSound.pause();
        bounceSound.currentTime = 0;
        soundUnlocked = true;
        enableBtn.disabled = true;
        enableBtn.textContent = 'Sound enabled';
      } catch (e) {
        console.warn('Fallback audio unlock failed:', e);
      } finally {
        document.removeEventListener('click', oneTime);
      }
    };
    document.addEventListener('click', oneTime);
  }
});

// plays a short instance of the bounce sound. We clone the audio node so overlapping bounces sound correctly.
function playBounceSound() {
  if (!soundUnlocked) {
    enableBtn.textContent = 'Click "Enable sound" to hear bounces';
    return;
  }
  try {
    const s = bounceSound.cloneNode();
    s.play().catch(e => console.warn('play prevented:', e));
  } catch (e) {
    console.warn('play error', e);
  }
}

/* -------- ANIMATION LOOP (with bounce sound trigger) -------- */

function animate() {
  if (!isDragging) {
    dy += gravity;
    x += dx;
    y += dy;
    dx *= friction;
    dy *= friction;

    // compute pre-collision speed so we can play sound based on how hard it hit
    const preSpeed = Math.hypot(dx, dy);
    const SOUND_THRESHOLD = 1.2; // adjust: how "hard" a bounce must be to play sound
    let bounced = false;

    if (x <= 0) {
      x = 0;
      if (Math.abs(dx) > VELOCITY_EPS) {
        dx = -dx;
        bounced = true;
      } else {
        dx = 0;
      }
    } else if (x + 100 >= window.innerWidth) {
      x = window.innerWidth - 100;
      if (Math.abs(dx) > VELOCITY_EPS) {
        dx = -dx;
        bounced = true;
      } else {
        dx = 0;
      }
    }

    if (y <= 0) {
      y = 0;
      if (Math.abs(dy) > VELOCITY_EPS) {
        dy = -dy;
        bounced = true;
      } else {
        dy = 0;
      }
    } else if (y + 100 >= window.innerHeight) {
      y = window.innerHeight - 100;
      if (Math.abs(dy) > VELOCITY_EPS) {
        dy = -dy;
        bounced = true;
      } else {
        dy = 0;
      }
    }

    // play sound once per frame if a bounce happened and the pre-collision speed was high enough
    if (bounced && preSpeed > SOUND_THRESHOLD) {
      playBounceSound();
    }
  }

  // rotates in the direction its "looking" in
  let targetAngle = Math.atan2(dy, dx) * (180 / Math.PI);
  let diff = targetAngle - currentAngle;
  if (diff > 180) diff -= 360;
  if (diff < -180) diff += 360;
  currentAngle += diff * 0.6;

  // speed-based stretch (squash and stretch at higher speeds)
  let speed = Math.sqrt(dx*dx + dy*dy);
  let stretchAlong = 1 + Math.min(speed * 0.03, 0.9);
  let stretchPerp  = 1 - Math.min(speed * 0.02, 0.5);

  dvd.style.transform = `rotate(${currentAngle}deg) scaleX(${stretchAlong}) scaleY(${stretchPerp}) scaleX(-1)`;
  dvd.style.left = x + 'px';
  dvd.style.top = y + 'px';

  requestAnimationFrame(animate);
}

animate();

window.addEventListener('resize', () => {
  if (x + 100 > window.innerWidth) x = window.innerWidth - 100;
  if (y + 100 > window.innerHeight) y = window.innerHeight - 100;
});
</script>
</body>
</html>
